{
    "$schema": "https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json",
    "id": "7c8f9a2b-1d3e-4f5a-9b7c-8e2d1f4a6c9b",
    "name": "OllamaCodeReview",
    "friendlyName": "Ollama Code Review",
    "description": "AI-powered code review using self-hosted Ollama with multi-pass verification workflow",
    "category": "Utility",
    "author": "teriansilva",
    "version": {
        "Major": 2,
        "Minor": 8,
        "Patch": 6
    },
    "instanceNameFormat": "Ollama Code Review",
    "groups": [
        {
            "name": "connection",
            "displayName": "Connection",
            "isExpanded": true
        },
        {
            "name": "review",
            "displayName": "Review Options",
            "isExpanded": true
        },
        {
            "name": "files",
            "displayName": "File Filters",
            "isExpanded": false
        },
        {
            "name": "multipass",
            "displayName": "Multi-Pass Workflow",
            "isExpanded": false
        },
        {
            "name": "advanced",
            "displayName": "Advanced",
            "isExpanded": false
        }
    ],
    "inputs": [
        {
            "name": "ollama_endpoint",
            "type": "string",
            "label": "API Endpoint",
            "groupName": "connection",
            "defaultValue": "http://localhost:11434/api/chat",
            "required": true,
            "helpMarkDown": "Full URL to your Ollama API endpoint. Examples:\n- `http://localhost:11434/api/chat`\n- `https://ollama.yourdomain.com/api/chat`"
        },
        {
            "name": "ai_model",
            "type": "string",
            "label": "Default Model",
            "groupName": "connection",
            "defaultValue": "gpt-oss:20b",
            "required": true,
            "helpMarkDown": "Default model for all passes. Recommended: `gpt-oss`, `qwen2.5-coder`, `deepseek-coder-v2`, `codellama`"
        },
        {
            "name": "bearer_token",
            "type": "string",
            "label": "Bearer Token",
            "groupName": "connection",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "Bearer token for authenticated endpoints. Use `$(VariableName)` for secrets."
        },
        {
            "name": "bugs",
            "type": "boolean",
            "label": "Check for bugs",
            "groupName": "review",
            "defaultValue": true,
            "helpMarkDown": "Enable bug detection (null pointers, logic errors, exceptions)."
        },
        {
            "name": "performance",
            "type": "boolean",
            "label": "Check for performance issues",
            "groupName": "review",
            "defaultValue": true,
            "helpMarkDown": "Enable performance analysis (inefficient algorithms, memory leaks)."
        },
        {
            "name": "best_practices",
            "type": "boolean",
            "label": "Check for best practices",
            "groupName": "review",
            "defaultValue": true,
            "helpMarkDown": "Enable best practice checks (coding standards, error handling)."
        },
        {
            "name": "additional_prompts",
            "type": "string",
            "label": "Additional Review Criteria",
            "groupName": "review",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "Comma-separated additional criteria. Example: `Check for security issues, Verify error handling`"
        },
        {
            "name": "custom_best_practices",
            "type": "multiLine",
            "label": "Custom Best Practices",
            "groupName": "review",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "Project-specific coding standards (one per line):\n```\nAlways use async/await\nAll public methods need JSDoc\nUse parameterized queries\n```"
        },
        {
            "name": "file_extensions",
            "type": "string",
            "label": "Include Extensions",
            "groupName": "files",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "Comma-separated file extensions to review. Example: `.js,.ts,.py,.cs`"
        },
        {
            "name": "file_excludes",
            "type": "string",
            "label": "Exclude Files",
            "groupName": "files",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "Comma-separated files to exclude. Example: `package-lock.json,*.min.js`"
        },
        {
            "name": "enableMultipass",
            "type": "boolean",
            "label": "Enable Multi-Pass Workflow",
            "groupName": "multipass",
            "defaultValue": true,
            "helpMarkDown": "## Multi-Pass Workflow\n\nWhen enabled (default), uses 4 passes:\n1. **Context Check** - AI requests additional files if needed\n2. **Review** - Generate code review\n3. **Format** - Enforce consistent structure\n4. **Verify** - Validate issues exist in code\n\nWhen disabled, only uses the Review pass (faster but less accurate)."
        },
        {
            "name": "pass1_model",
            "type": "string",
            "label": "Pass 1 Model (Context)",
            "groupName": "multipass",
            "defaultValue": "",
            "required": false,
            "visibleRule": "enableMultipass=true",
            "helpMarkDown": "Model for context check pass. Leave empty to use default model. Use a faster/smaller model for cost savings."
        },
        {
            "name": "pass1_prompt",
            "type": "multiLine",
            "label": "Pass 1 Prompt (Context)",
            "groupName": "multipass",
            "defaultValue": "",
            "required": false,
            "visibleRule": "enableMultipass=true",
            "helpMarkDown": "Custom prompt for context check. Must respond with `READY` or `REQUEST_CONTEXT: file1, file2`"
        },
        {
            "name": "pass2_model",
            "type": "string",
            "label": "Pass 2 Model (Review)",
            "groupName": "multipass",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "Model for review pass. Leave empty to use default model. Use your best model here."
        },
        {
            "name": "pass2_prompt",
            "type": "multiLine",
            "label": "Pass 2 Prompt (Review)",
            "groupName": "multipass",
            "defaultValue": "",
            "required": false,
            "helpMarkDown": "Custom prompt for code review. Must respond with `NO_COMMENT` if no issues."
        },
        {
            "name": "pass3_model",
            "type": "string",
            "label": "Pass 3 Model (Format)",
            "groupName": "multipass",
            "defaultValue": "",
            "required": false,
            "visibleRule": "enableMultipass=true",
            "helpMarkDown": "Model for format pass. Leave empty to use default model. A smaller model works fine here."
        },
        {
            "name": "pass3_prompt",
            "type": "multiLine",
            "label": "Pass 3 Prompt (Format)",
            "groupName": "multipass",
            "defaultValue": "",
            "required": false,
            "visibleRule": "enableMultipass=true",
            "helpMarkDown": "Custom prompt for formatting. Enforces: Summary + Issues Found structure."
        },
        {
            "name": "pass4_model",
            "type": "string",
            "label": "Pass 4 Model (Verify)",
            "groupName": "multipass",
            "defaultValue": "",
            "required": false,
            "visibleRule": "enableMultipass=true",
            "helpMarkDown": "Model for verify pass. Leave empty to use default model."
        },
        {
            "name": "pass4_prompt",
            "type": "multiLine",
            "label": "Pass 4 Prompt (Verify)",
            "groupName": "multipass",
            "defaultValue": "",
            "required": false,
            "visibleRule": "enableMultipass=true",
            "helpMarkDown": "Custom prompt for verification. Removes hallucinated issues."
        },
        {
            "name": "token_limit",
            "type": "string",
            "label": "Token Limit",
            "groupName": "advanced",
            "defaultValue": "8192",
            "required": false,
            "helpMarkDown": "Max tokens per request. Values: 8192, 16384, 32768, 65536, 131072"
        },
        {
            "name": "debug_logging",
            "type": "boolean",
            "label": "Enable Debug Logging",
            "groupName": "advanced",
            "defaultValue": false,
            "required": false,
            "helpMarkDown": "Output detailed logs for troubleshooting. Warning: increases log size significantly."
        }
    ],
    "execution": {
        "Node20_1": {
            "target": "main.js"
        }
    }
}
